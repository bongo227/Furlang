box: bongo227/furlang-docker:latest

build:
    steps:
        - script:
            name: Move to gopath
            code: |
                mkdir -p $GOPATH/src/github.com/bongo227/Furlang
                mv * $GOPATH/src/github.com/bongo227/Furlang/
        
        - script:
            name: Install dependencys
            cwd: $GOPATH/src/github.com/bongo227/Furlang/
            code: |
                go get ./...

        - script:
            name: Build project
            cwd: $GOPATH/src/github.com/bongo227/Furlang/
            code: |
                mkdir build
                go build -o build/furlang

test:
    steps:
        - script:
            name: Go test
            cwd: $GOPATH/src/github.com/bongo227/Furlang/
            code: |
                go test ./...
        
        - script:
            name: Intergration Tests
            cwd: $GOPATH/src/github.com/bongo227/Furlang/
            code: |
                bash makeTests.sh
                bats build/tests.bats

        - script:
            name: Go lint
            cwd: $GOPATH/src/github.com/bongo227/Furlang/
            code: |
                go lint ./...

        - script:
            name: Dead code check
            cwd: $GOPATH/src/github.com/bongo227/Furlang/
            code: |
                go get honnef.co/go/unused/cmd/unused
                unused ./...